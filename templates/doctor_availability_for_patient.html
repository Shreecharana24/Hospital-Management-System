<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Availability - Dr. {{ doctor.user.name }}</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      background-color: #f5f6fa;
    }
    h2 {
      color: #2f3640;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      max-width: 1000px;
    }
    .back-btn {
      display: inline-block;
      padding: 8px 16px;
      background-color: #718093;
      color: white;
      text-decoration: none;
      border-radius: 5px;
      margin-bottom: 20px;
    }
    .back-btn:hover {
      background-color: #596275;
    }

    .grid-container {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    .day-column {
      min-width: 200px;
      flex: 1;
    }

    .date-header {
      background: #eef;
      padding: 12px;
      border-radius: 6px;
      text-align: center;
      margin-bottom: 8px;
      font-weight: bold;
      border: 2px solid #ccc;
    }

    .slot-box {
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 8px;
      text-align: center;
      border: 2px solid #ccc;
      cursor: pointer;
      transition: all 0.2s;
    }

    .slot-available {
      background: #e6ffed;
      border-color: #2ecc71;
      color: #2d7a3e;
    }

    .slot-available:hover {
      box-shadow: 0 4px 8px rgba(46, 204, 113, 0.3);
    }

    .slot-unavailable {
      background: #ffecec;
      border-color: #e74c3c;
      color: #7a2626;
    }

    .slot-time {
      font-weight: bold;
      margin-bottom: 4px;
    }

    .slot-status {
      font-size: 0.9em;
    }

    .book-btn {
      display: inline-block;
      padding: 8px 16px;
      background-color: #44bd32;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      text-decoration: none;
      font-weight: bold;
      margin-top: 8px;
    }

    .book-btn:hover {
      background-color: #009432;
    }

    .book-btn:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    form {
      display: contents;
    }
  </style>
</head>
<body>

  <div class="container">
    <h2>Dr. {{ doctor.user.name }} - Availability</h2>

    <a href="{{ url_for('patient.patient_dashboard') }}" class="back-btn">Go Back</a>

    <div class="grid-container">
      {% for d in next_7 %}
      {% set date_str = d.isoformat() %}
      <div class="day-column">
        <div class="date-header">{{ d.strftime('%d/%m/%Y') }}</div>
        {% for slot in slots %}
          {% set av = avail_map.get(date_str, {}).get(slot.label) if avail_map else None %}
          {% set status = av.status if av else None %}
          {% set expired = disabled_map.get(date_str, {}).get(slot.label) if disabled_map else False %}

          <div class="slot-box {% if expired %}slot-disabled{% elif status == 'Available' %}slot-available{% else %}slot-unavailable{% endif %}">
            <div class="slot-time">{{ slot.label }}</div>
            <div class="slot-status">
              {% if expired %}
                Expired
              {% elif status == 'Available' %}
                Available
              {% elif status == 'Booked' %}
                Booked
              {% else %}
                Not Available
              {% endif %}
            </div>
            {% if av and av.status == 'Available' and not expired %}
              <form method="POST" style="display:inline;">
                <input type="hidden" name="doctor_id" value="{{ doctor.id }}">
                <input type="hidden" name="avail_id" value="{{ av.id }}">
                <button type="submit" class="book-btn">Book</button>
              </form>
            {% endif %}
          </div>
        {% endfor %}
      </div>
      {% endfor %}
    </div>
  </div>

</body>
</html>

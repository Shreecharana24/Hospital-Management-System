<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Doctor Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background-color: #f5f6fa;
        }
        h1 {
            color: #2f3640;
        }
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            text-decoration: none;
        }
        .logout { background-color: #e84118; }
        .view { background-color: #44bd32; }
        .complete { background-color: #0097e6;
                    margin-right: 4px; }
        .notes { background-color: #fbc531; color: black; }
        .cancel { background-color: #718093; }
        .section {
            background: white;
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f1f2f6;
        }
    </style>
</head>
<body>
    {% include 'logout.html' %}

    <div class="top-bar">
        <h1>Welcome, Dr. {{ doctor.user.name }}</h1>
    </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert 
                        {% if category == 'success' %}alert-success
                        {% elif category == 'error' %}alert-danger
                        {% elif category == 'warning' %}alert-warning
                        {% else %}alert-info{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

    <!-- Upcoming Appointments -->
    <div class="section">
        <h2>Upcoming Appointments</h2>
        <table>
            <tr>
                <th>Sr. No.</th>
                <th>Patient</th>
                <th>Date</th>
                <th>Time</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
            {% for appt in appointments %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ appt.patient.user.name }}</td>
                <td>{{ appt.date }}</td>
                <td>{{ appt.time }}</td>
                <td>{{ appt.status }}</td>
                <td>
                    {% if appt.status != 'Completed' %}
                    <a href="{{ url_for('doctor.update_history', appt_id=appt.id) }}" class="btn complete">
                        Mark Completed
                    </a>

                    {% endif %}
                    <a href="{{ url_for('doctor.update_history', appt_id=appt.id) }}" class="btn notes">Update</a>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <!-- Assigned Patients -->
    <div class="section">
        <h2>Assigned Patients</h2>
        <table>
            <tr>
                <th>Sr. No.</th>
                <th>Patient</th>
                <th>Actions</th>
            </tr>
            {% set seen = [] %}
            {% for appt in appointments %}
                {% if appt.patient.id not in seen %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ appt.patient.user.name }}</td>
                    <td>
                        <a href="{{ url_for('doctor.patient_history', patient_id=appt.patient.id) }}" class="btn view">View History</a>
                    </td>
                </tr>
                {% set _ = seen.append(appt.patient.id) %}
                {% endif %}
            {% endfor %}
        </table>
        <div style="margin-top: 20px; text-align: right;">
            <a href="{{ url_for('doctor.doctor_availability') }}" class="btn view">Provide Availability</a>
        </div>
    </div>
</body>
</html>
